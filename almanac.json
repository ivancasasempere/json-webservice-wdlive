<?php header('content-type: application/json; charset=utf-8');

    # Copyright 2014 Wayne D Grant (www.waynedgrant.com)
    # Licensed under the MIT License

    include 'common.php';
    include 'pressure.php';
    include 'rainfall.php';
    include 'temperature.php';
    include 'wind.php';
    include 'uv.php';

    $client_raw_fields = get_client_raw_fields();
    $client_raw_extra_fields = get_client_raw_extra_fields();

    function get_month_to_date_item()
    {
        global $client_raw_fields, $client_raw_extra_fields;

        // Temperature

        $month_to_date_temperature_high_item = get_temperature_item($client_raw_extra_fields, 61);
        $month_to_date_temperature_high_item['time'] = get_time_item($client_raw_extra_fields, 62, 63, 64, 65, 66);

        $month_to_date_temperature_low_item = get_temperature_item($client_raw_extra_fields, 67);
        $month_to_date_temperature_low_item['time'] = get_time_item($client_raw_extra_fields, 68, 69, 70, 71, 72);

        $month_to_date_temperature_item = array(
            "high" => $month_to_date_temperature_high_item,
            "low" => $month_to_date_temperature_low_item);

        // Pressure

        $month_to_date_pressure_high_item = get_pressure_item($client_raw_extra_fields, 91);
        $month_to_date_pressure_high_item['time'] = get_time_item($client_raw_extra_fields, 92, 93, 94, 95, 96);

        $month_to_date_pressure_low_item = get_pressure_item($client_raw_extra_fields, 85);
        $month_to_date_pressure_low_item['time'] = get_time_item($client_raw_extra_fields, 86, 87, 88, 89, 90);

        $month_to_date_pressure_item = array(
            "high" => $month_to_date_pressure_high_item,
            "low" => $month_to_date_pressure_low_item);

        // Rainfall

        $month_to_date_max_rate_per_min = get_rainfall_rate_item($client_raw_extra_fields, 79);
        $month_to_date_max_rate_per_min['time'] = get_time_item($client_raw_extra_fields, 80, 81, 82, 83, 84);

        $month_to_date_rainfall_item = array("max_rate_per_min" => $month_to_date_max_rate_per_min);

        // Wind

        $month_to_date_max_avg_item = array(
            "speed" => get_wind_speed_item($client_raw_extra_fields, 109),
            "direction" => get_wind_direction_item($client_raw_extra_fields, 145),
            "time" =>  get_time_item($client_raw_extra_fields, 110, 111, 112, 113, 114));

        $month_to_date_max_gust_item = array(
            "speed" => get_wind_speed_item($client_raw_extra_fields, 73),
            "direction" => get_wind_direction_item($client_raw_extra_fields, 139),
            "time" =>  get_time_item($client_raw_extra_fields, 74, 75, 76, 77, 78));

        $month_to_date_wind_item = array(
            "max_avg" => $month_to_date_max_avg_item,
            "max_gust" => $month_to_date_max_gust_item);

        // Dew Point

        $month_to_date_dew_point_high_item = get_temperature_item($client_raw_extra_fields, 729);
        $month_to_date_dew_point_high_item['time'] = get_time_item($client_raw_extra_fields, 730, 731, 732, 733, 734);

        $month_to_date_dew_point_low_item = get_temperature_item($client_raw_extra_fields, 735);
        $month_to_date_dew_point_low_item['time'] = get_time_item($client_raw_extra_fields, 736, 737, 738, 739, 740);

        $month_to_date_dew_point_item = array(
            "high" => $month_to_date_dew_point_high_item,
            "low" => $month_to_date_dew_point_low_item);

        // Wind Chill

        $month_to_date_wind_chill_low_item = get_temperature_item($client_raw_extra_fields, 133);
        $month_to_date_wind_chill_low_item['time'] = get_time_item($client_raw_extra_fields, 134, 135, 136, 137, 138);

        $month_to_date_wind_chill_item = array("low" => $month_to_date_wind_chill_low_item);

        // Heat Index

        $month_to_date_heat_index_high_item = get_temperature_item($client_raw_extra_fields, 175);
        $month_to_date_heat_index_high_item['time'] = get_time_item($client_raw_extra_fields, 176, 177, 178, 179, 180);

        $month_to_date_heat_index_item = array("high" => $month_to_date_heat_index_high_item);

        // UV

        $month_to_date_uv_high_item = get_uv_item($client_raw_extra_fields, 666);
        $month_to_date_uv_high_item['time'] = get_time_item($client_raw_extra_fields, 667, 668, 669, 670, 671);

        $month_to_date_uv_item = array("high" => $month_to_date_uv_high_item);

        $month_to_date_item = array(
            "month" => get_value(read_client_raw_field($client_raw_fields, 36)),
            "year" => get_value(read_client_raw_field($client_raw_fields, 141)),
            "temperature" => $month_to_date_temperature_item,
            "pressure" => $month_to_date_pressure_item,
            "rainfall" => $month_to_date_rainfall_item,
            "wind" => $month_to_date_wind_item,
            "dew_point" => $month_to_date_dew_point_item,
            "wind_chill" => $month_to_date_wind_chill_item,
            "heat_index" => $month_to_date_heat_index_item,
            "uv" => $month_to_date_uv_item);

        return $month_to_date_item;
    }

    function get_year_to_date_item()
    {
        global $client_raw_fields, $client_raw_extra_fields;

        // Temperature

        $year_to_date_temperature_high_item = get_temperature_item($client_raw_extra_fields, 187);
        $year_to_date_temperature_high_item['time'] = get_time_item($client_raw_extra_fields, 188, 189, 190, 191, 192);

        $year_to_date_temperature_low_item = get_temperature_item($client_raw_extra_fields, 193);
        $year_to_date_temperature_low_item['time'] = get_time_item($client_raw_extra_fields, 194, 195, 196, 197, 198);

        $year_to_date_temperature_item = array(
            "high" => $year_to_date_temperature_high_item,
            "low" => $year_to_date_temperature_low_item);

        // Pressure

        $year_to_date_pressure_high_item = get_pressure_item($client_raw_extra_fields, 217);
        $year_to_date_pressure_high_item['time'] = get_time_item($client_raw_extra_fields, 218, 219, 220, 221, 222);

        $year_to_date_pressure_low_item = get_pressure_item($client_raw_extra_fields, 211);
        $year_to_date_pressure_low_item['time'] = get_time_item($client_raw_extra_fields, 212, 213, 214, 215, 216);

        $year_to_date_pressure_item = array(
            "high" => $year_to_date_pressure_high_item,
            "low" => $year_to_date_pressure_low_item);

        // Rainfall

        $year_to_date_max_rate_per_min = get_rainfall_rate_item($client_raw_extra_fields, 205);
        $year_to_date_max_rate_per_min['time'] = get_time_item($client_raw_extra_fields, 206, 207, 208, 209, 210);

        $year_to_date_rainfall_item = array("max_rate_per_min" => $year_to_date_max_rate_per_min);

        // Wind

        $year_to_date_max_avg_item = array(
            "speed" => get_wind_speed_item($client_raw_extra_fields, 235),
            "direction" => get_wind_direction_item($client_raw_extra_fields, 271),
            "time" =>  get_time_item($client_raw_extra_fields, 236, 237, 238, 239, 240));

        $year_to_date_max_gust_item = array(
            "speed" => get_wind_speed_item($client_raw_extra_fields, 199),
            "direction" => get_wind_direction_item($client_raw_extra_fields, 265),
            "time" =>  get_time_item($client_raw_extra_fields, 200, 201, 202, 203, 204));

        $year_to_date_wind_item = array(
            "max_avg" => $year_to_date_max_avg_item,
            "max_gust" => $year_to_date_max_gust_item);

        // Dew Point

        $year_to_date_dew_point_high_item = get_temperature_item($client_raw_extra_fields, 741);
        $year_to_date_dew_point_high_item['time'] = get_time_item($client_raw_extra_fields, 742, 743, 744, 745, 746);

        $year_to_date_dew_point_low_item = get_temperature_item($client_raw_extra_fields, 747);
        $year_to_date_dew_point_low_item['time'] = get_time_item($client_raw_extra_fields, 748, 749, 750, 751, 752);

        $year_to_date_dew_point_item = array(
            "high" => $year_to_date_dew_point_high_item,
            "low" => $year_to_date_dew_point_low_item);

        // Wind Chill

        $year_to_date_wind_chill_low_item = get_temperature_item($client_raw_extra_fields, 259);
        $year_to_date_wind_chill_low_item['time'] = get_time_item($client_raw_extra_fields, 260, 261, 262, 263, 264);

        $year_to_date_wind_chill_item = array("low" => $year_to_date_wind_chill_low_item);

        // Heat Index

        $year_to_date_heat_index_high_item = get_temperature_item($client_raw_extra_fields, 301);
        $year_to_date_heat_index_high_item['time'] = get_time_item($client_raw_extra_fields, 302, 303, 304, 305, 306);

        $year_to_date_heat_index_item = array("high" => $year_to_date_heat_index_high_item);

        // UV

        $year_to_date_uv_high_item = get_uv_item($client_raw_extra_fields, 678);
        $year_to_date_uv_high_item['time'] = get_time_item($client_raw_extra_fields, 679, 680, 681, 682, 683);

        $year_to_date_uv_item = array("high" => $year_to_date_uv_high_item);

        $year_to_date_item = array(
            "year" => get_value(read_client_raw_field($client_raw_fields, 141)),
            "temperature" => $year_to_date_temperature_item,
            "pressure" => $year_to_date_pressure_item,
            "rainfall" => $year_to_date_rainfall_item,
            "wind" => $year_to_date_wind_item,
            "dew_point" => $year_to_date_dew_point_item,
            "wind_chill" => $year_to_date_wind_chill_item,
            "heat_index" => $year_to_date_heat_index_item,
            "uv" => $year_to_date_uv_item);

        return $year_to_date_item;
    }

    function get_all_time_item()
    {
        global $client_raw_fields, $client_raw_extra_fields;

        // Temperature

        $all_time_temperature_high_item = get_temperature_item($client_raw_extra_fields, 313);
        $all_time_temperature_high_item['time'] = get_time_item($client_raw_extra_fields, 314, 315, 316, 317, 318);

        $all_time_temperature_low_item = get_temperature_item($client_raw_extra_fields, 319);
        $all_time_temperature_low_item['time'] = get_time_item($client_raw_extra_fields, 320, 321, 322, 323, 324);

        $all_time_temperature_item = array(
            "high" => $all_time_temperature_high_item,
            "low" => $all_time_temperature_low_item);

        // Pressure

        $all_time_pressure_high_item = get_pressure_item($client_raw_extra_fields, 343);
        $all_time_pressure_high_item['time'] = get_time_item($client_raw_extra_fields, 344, 345, 346, 347, 348);

        $all_time_pressure_low_item = get_pressure_item($client_raw_extra_fields, 337);
        $all_time_pressure_low_item['time'] = get_time_item($client_raw_extra_fields, 338, 339, 340, 341, 342);

        $all_time_pressure_item = array(
            "high" => $all_time_pressure_high_item,
            "low" => $all_time_pressure_low_item);

        // Rainfall

        $all_time_max_rate_per_min = get_rainfall_rate_item($client_raw_extra_fields, 331);
        $all_time_max_rate_per_min['time'] = get_time_item($client_raw_extra_fields, 332, 333, 334, 335, 336);

        $all_time_rainfall_item = array("max_rate_per_min" => $all_time_max_rate_per_min);

        // Wind

        $all_time_max_avg_item = array(
            "speed" => get_wind_speed_item($client_raw_extra_fields, 361),
            "direction" => get_wind_direction_item($client_raw_extra_fields, 397),
            "time" =>  get_time_item($client_raw_extra_fields, 362, 363, 364, 365, 366));

        $all_time_max_gust_item = array(
            "speed" => get_wind_speed_item($client_raw_extra_fields, 325),
            "direction" => get_wind_direction_item($client_raw_extra_fields, 391),
            "time" =>  get_time_item($client_raw_extra_fields, 326, 327, 328, 329, 330));

        $all_time_wind_item = array(
            "max_avg" => $all_time_max_avg_item,
            "max_gust" => $all_time_max_gust_item);

        // Dew Point

        $all_time_dew_point_high_item = get_temperature_item($client_raw_extra_fields, 753);
        $all_time_dew_point_high_item['time'] = get_time_item($client_raw_extra_fields, 754, 755, 756, 757, 758);

        $all_time_dew_point_low_item = get_temperature_item($client_raw_extra_fields, 759);
        $all_time_dew_point_low_item['time'] = get_time_item($client_raw_extra_fields, 760, 761, 762, 763, 764);

        $all_time_dew_point_item = array(
            "high" => $all_time_dew_point_high_item,
            "low" => $all_time_dew_point_low_item);

        // Wind Chill

        $all_time_wind_chill_low_item = get_temperature_item($client_raw_extra_fields, 385);
        $all_time_wind_chill_low_item['time'] = get_time_item($client_raw_extra_fields, 386, 387, 388, 389, 390);

        $all_time_wind_chill_item = array("low" => $all_time_wind_chill_low_item);

        // Heat Index

        $all_time_heat_index_high_item = get_temperature_item($client_raw_extra_fields, 427);
        $all_time_heat_index_high_item['time'] = get_time_item($client_raw_extra_fields, 428, 429, 430, 431, 432);

        $all_time_heat_index_item = array("high" => $all_time_heat_index_high_item);

        // UV

        $all_time_uv_high_item = get_uv_item($client_raw_extra_fields, 690);
        $all_time_uv_high_item['time'] = get_time_item($client_raw_extra_fields, 691, 692, 693, 694, 695);

        $all_time_uv_item = array("high" => $all_time_uv_high_item);

        $all_time_item = array(
            "temperature" => $all_time_temperature_item,
            "pressure" => $all_time_pressure_item,
            "rainfall" => $all_time_rainfall_item,
            "wind" => $all_time_wind_item,
            "dew_point" => $all_time_dew_point_item,
            "wind_chill" => $all_time_wind_chill_item,
            "heat_index" => $all_time_heat_index_item,
            "uv" => $all_time_uv_item);

        return $all_time_item;
    }

    $data = array(
        "endpoint" => get_endpoint_item(),
        "station" => get_station_item($client_raw_fields),
        "month_to_date" => get_month_to_date_item(),
        "year_to_date" => get_year_to_date_item(),
        "all_time" => get_all_time_item());

    $json = json_encode($data);

    echo isset($_GET['callback']) ? "{$_GET['callback']}($json)" : $json;

?>
